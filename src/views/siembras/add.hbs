<div class="container p-4">
    <h2><center>Siembras</center></h2>
    <h3><center>Agrega un nuevo producto </center></h3>
    <div class="row">
        <div class="col-md-12 mx-auto">
            <div class="card ">
                <div class="card-body">
                    <form action="/inventario/add" method="POST">
                        <div class="form-group m-3">
                            <input type="text" class="form-control" name="nom_productoSi"  placeholder="Nombre producto" autofocus>
                        </div>
                        <div class="form-group m-3">
                            <input type="text" class="form-control" name="cantidad" placeholder="Cantidad">
                        </div>
                        <div class="form-group m-3">
                            <input type="checkbox" name="descripcion_cant" value="Kg">
                            <label for="kg">Kg</label>
                            <input type="checkbox" name="descripcion_cant" value="Piezas">
                            <label for="kg">Piezas</label>
                        </div>
                        <p class="p-2">Genero producto</p>
                        <div class="form-group m-3">
                            <input type="checkbox" class="" name="genero" value="Frutas y verduras" />
                            <label for="Frutas y verduras">Frutas y verduras</label>
                        </div>
                        <div class="form-group m-3">
                            <input type="checkbox" class="" name="genero" value="Carnes" />
                            <label for="Carnes">Carnes</label>
                        </div>
                        <div class="form-group m-3">
                            <input type="checkbox" class="" name="genero" value="Lácteos" />
                            <label for="Lácteos">Lacteos</label>
                        </div>
                        <div class="form-group m-3">
                            <input type="checkbox" class="" name="genero" value="Panes y cereales" />
                            <label for="Panes y cereales">Panes y cereales</label>
                        </div>
                        <div class="form-group m-3">
                            <input type="checkbox" class="" name="genero" value="Limpieza" />
                            <label for="Limpieza">Limpieza</label>
                        </div>
                        <div class="form-group m-3">
                            <input type="checkbox" class="" name="genero" value="Utencilios" />
                            <label for="Utencilios">Utencilios (Platos, Cucharas, Tenedores, Cuchillos, etc)</label>
                        </div>
                         <div class="form-group m-3">
                            <input hidden type="num" class="form-control" id="id" name="id_personaSi" placeholder="Id">
                        </div>
                        <div class="form-group m-3">
                            <input type="text" class="form-control" autocomplete="off" name="nombresSi" id="search-persona" placeholder="Nombre sembrador">
                            <ul class="autocomplete-results bg-black text-light list-group" id="users">
                            </ul>
                        </div>
                        <div class="form-group m-3">
                            <input type="text" class="form-control" id="apellidoP" name="a_paterno" placeholder="Apellido paterno sembrador">
                        </div>
                        <div class="form-group m-3">
                            <input type="text" class="form-control" id="apellidoM" name="a_materno" placeholder="Apellido materno sembrador">
                        </div>
                        <div class="form-group m-3">
                            <input type="tel" class="form-control" name="num_tel" id="num_tel" placeholder="Telefono">
                        </div>
                        <div class="form-group m-3">
                            <input type="text" class="form-control" name="nom_recibe" placeholder="Nombre recibe">
                        </div>
                        <div class="form-group m-3">
                            <input type="datetime-local" class="form-control" name="fecha_recibe" placeholder="Nombre sembrador">
                        </div>
                        <div class="form-control justify-content-center">
                            <button class="btn btn-outline-success btn-lg btn-block">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    let inputid = document.getElementById("id");
    let input = document.getElementById("search-persona");
    let inputap = document.getElementById("apellidoP");
    let inputam = document.getElementById("apellidoM");
    let userList = document.getElementById("users");
    let inputel = document.getElementById("num_tel");
    var users = []; 
    let id = "";
    let name = "";
    let last_n = "";
    let last_n_m = "";
    let tel = "";
    let all = "";   
    
    window.addEventListener('DOMContentLoaded', async()=>{
    const data = await loadUsers();
    users = data;
    //renderUsers(users)
    
    //console.log(users);
    });
    
    const validar = async function(string){
        const data1 =  await users;
        //console.log(data1)
        user = data1;
        var loadusername = await user.map(user => (user.nombres_persona + " " + user.a_paterno+ " "+ user.a_materno)); 
       // await console.log(loadusername);
    }

    validar("s");
    
    input.addEventListener("keyup", (event) => {
        const newUsers = users.filter(user => `${user.nombres_persona.toLowerCase()} ${user.a_paterno.toLowerCase()} ${user.a_materno.toLowerCase()}`.includes(input.value.toLowerCase()));
        renderUsers(newUsers); 
    });

    

    const loadUsers = async ()=>{
       const response = await fetch('/registropersonas/all');
       return await response.json();
    }

    const createUserItems = users => users.map(user => `<a><li class="list-group-item p-1" style="cursor:pointer;">${user.nombres_persona} ${user.a_paterno} ${user.a_materno}</li></a>`).join(' ');

    const renderUsers = (users)=>{
        const itemsString = createUserItems(users);
        userList.innerHTML = itemsString;
    };

    userList.addEventListener("click", async(e)=>{
        const data = await loadUsers();
        //await console.log(data);
        var usuario = [];
        usuario = data;
        if(e.target && e.target.nodeName == "LI"){
            var loadusername = await usuario.map(user => {
                let id1=user.id_persona;
                let name1=user.nombres_persona;
                let last_n1=user.a_paterno;
                let last_n_m1=user.a_materno;
                let tel1 = user.num_tel;
                all = name1+" "+last_n1+" "+last_n_m1;
                if(all == e.target.innerHTML){
                    id=id1;
                    name=name1;
                    last_n=last_n1;
                    last_n_m=last_n_m1;
                    tel=tel1;
                    inputid.value = id;
                    input.value = name;
                    inputap.value = last_n;
                    inputam.value = last_n_m; 
                    inputel.value = tel;
                }
            });
            
            renderUsers([]);
        }
    });

    //https://www.youtube.com/watch?v=DgunJ2jMZwM
    //https://www.youtube.com/watch?v=cN_wouQBnqE
</script>